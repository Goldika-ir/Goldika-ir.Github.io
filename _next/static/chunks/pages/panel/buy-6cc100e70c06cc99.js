(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7564],{1912:function(a,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/panel/buy",function(){return t(5410)}])},5410:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return F}});var r=t(5893),n=t(629),l=t(1313),o=t(1737),s=t(3321),i=t(2140),c=t(5549),m=t(9392),u=t(4763),d=t(9922),p=t(9186),x=t(5608),g=t(3409),h=t(6445),b=t(1907),N=t(4006),f=t(6840),v=t(7294),j=t(3710),E=t(489),y=t(8135),w=t(6717);function A(){return c.wp.getValue().buy}function V(a){return c.Os.getValue()[a]}function F(){let a=c.wp.use(),e=a.buy,t=c.Os.use(),[F,M]=(0,x.YZ)(),k=(0,x.YM)(()=>({amount:"",amountError:null,total:"",totalError:null,formErrors:[],validatedOnce:!1,sliderValue:0,valueFromSlider:!0,confirmDialogOpen:!1,version:0})),O=(0,x.GK)(()=>({setAmount:(0,f.yH)(k,"amount",a=>{k.amountError=null,O.update(""===a?NaN:+a,"setTotal")}),setTotal:(0,f.yH)(k,"total",a=>{k.totalError=null,O.update(""===a?NaN:+a/A(),"setAmount")}),reset(){k.amount="",k.amountError=null,k.total="",k.totalError=null,k.formErrors=[],k.validatedOnce=!1,k.sliderValue=0,k.valueFromSlider=!0,k.confirmDialogOpen=!1},async fixAmount(){let a=await k.currentState;a.valueFromSlider||O.update(""===a.amount?NaN:+u.YL.getFormattedText(a.amount),"setBoth")},maxAmount:()=>Math.floor(V("rial")/A()*u.bM)/u.bM,update(a,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"noMax";if(k.valueFromSlider=!1,Number.isNaN(a)){("setAmount"===e||"setBoth"===e)&&(k.amount="",k.amountError=null),("setTotal"===e||"setBoth"===e)&&(k.total="",k.totalError=null),O.revalidate();return}a=Math.round(a*u.bM)/u.bM,"maxAmount"===t&&(a=Math.min(a,O.maxAmount())),("setAmount"===e||"setBoth"===e)&&(k.amount=(0,u.Yu)(a)),("setTotal"===e||"setBoth"===e)&&(k.total="".concat(10*Math.round(a*A()/10))),O.revalidate()},setSliderValue(a,e){if(Array.isArray(e))throw Error("Assertion error.");k.sliderValue=e,O.update(V("rial")*(e/100)/A(),"setBoth","maxAmount"),k.valueFromSlider=!0},formatSliderLabel:a=>(0,N.V)("".concat(a,"٪")),async revalidate(){k.renderedState.validatedOnce&&O.validate(await k.currentState)},validate(a){var e;let t=[],r=!0;k.validatedOnce=!0;let n=+a.amount;return(null===(e=c.W4.getValue())||void 0===e?void 0:e.isGuest)&&(t.push("شما کاربر مهمان هستید و امکان خرید ندارید."),r=!1),isNaN(n)?(k.amountError="مقدار وارد شده صحبح نیست.",r=!1):(k.amountError=null,n<.001&&(t.push("حداقل مقدار خرید طلا ".concat((0,N.V)("".concat(.001))," گرم می‌باشد.")),r=!1),V("rial")<A()*n&&(r=!1)),k.formErrors=t,r},openConfirmDialog:(0,f.PF)(async function(){let a=await k.currentState;O.update(+a.amount,"setBoth","maxAmount"),O.validate(a)&&(k.confirmDialogOpen=!0)}),closeConfirmDialog(){k.confirmDialogOpen=!1}})),S=(0,g.M)(()=>({submit:(0,b.K)(k,async e=>{await (0,E.E6)({action:"buy",amount:+e.amount,priceId:a.id}),i.Mn.manager.action(),O.reset()},{addLoadingCounter:M,validator:O.validate,successMessage:"معامله‌ی شما با موفقیت انجام شد.",errorMessage:m.e$})})),T=k.confirmDialogOpen;return(0,v.useEffect)(()=>(T||i.OG.start(),i.Mn.start(),()=>{i.OG.cancel(),i.Mn.cancel()}),[T]),(0,r.jsxs)(w.Z,{maxWidth:30,children:[(0,r.jsx)("form",{onSubmit:O.openConfirmDialog,children:(0,r.jsxs)(n.Z,{className:"back-bg2 margin-tb-1 padding-a-3",children:[(0,r.jsxs)("div",{className:"row xitems-center margin-b-2 margin-t-1 margin-se-2",children:[(0,r.jsx)(j.f6,{className:"svg-icon large margin-e-1"}),(0,r.jsxs)("span",{className:"grow",children:[(0,r.jsx)("span",{className:"bold-2 large-p5",children:"خرید طلا"}),(0,r.jsx)("div",{className:"grow"}),(0,r.jsx)("div",{className:"row",children:(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{children:"قیمت خرید:"})," ",(0,r.jsx)("span",{className:"ltr color-buy",children:(0,N.V)(u.rn.getFormattedText("".concat(e)))})," ","ریال"]})})]})]}),(0,r.jsx)(d.x,{className:"margin-t-2",label:"مقدار طلا",value:k.amount,onValueChange:O.setAmount,onBlur:O.fixAmount,textFormatter:u.YL,error:null!==k.amountError,helperText:k.amountError,InputProps:{className:"back-bg",endAdornment:(0,r.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"گرم"})},autoFocus:!0,autoComplete:"off",inputProps:{className:"ltr"}}),(0,r.jsx)(d.x,{className:"margin-t-2",label:"ارزش کل",value:k.total,onValueChange:O.setTotal,onBlur:O.fixAmount,textFormatter:u.rn,error:null!==k.totalError,helperText:k.totalError,InputProps:{className:"back-bg",endAdornment:(0,r.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"ریال"})},autoComplete:"off",inputProps:{className:"ltr"}}),(0,r.jsxs)("span",{className:"margin-tb-2 padding-s-2 block",children:[(0,r.jsx)(j.Fl,{className:"svg-icon margin-e-1"}),(0,r.jsx)("span",{children:"موجودی کیف پول:"})," ",(0,r.jsx)("span",{className:"ltr",children:(0,N.V)(u.rn.getFormattedText("".concat(t.rial)))})," ","ریال"]}),(0,r.jsx)("div",{className:"margin-se-3",children:(0,r.jsx)(l.ZP,{step:10,marks:!0,min:0,max:100,valueLabelFormat:O.formatSliderLabel,value:k.sliderValue,onChange:O.setSliderValue,color:k.valueFromSlider?"primary":"gray",valueLabelDisplay:"auto"})}),+k.total>t.rial&&(0,r.jsx)(o.Z,{className:"margin-tb-3",severity:"warning",action:(0,r.jsx)(p.Qj,{variant:"text",color:"inherit",href:{pathname:"/panel/deposit",query:{amount:"".concat(+k.total-t.rial)}},size:"small",style:{textDecoration:"underline"},children:"افزایش موجودی"}),children:(0,r.jsx)("b",{className:"block",children:"موجودی کیف پول کافی نیست."})}),0!==k.formErrors.length&&(0,r.jsx)(o.Z,{className:"margin-tb-3",severity:"error",children:k.formErrors.map((a,e)=>(0,r.jsx)("b",{className:"block margin-tb-p5",children:a},e))}),(0,r.jsx)(s.Z,{className:"xself-center margin-t-2 padding-se-5",color:"buy",type:"submit",children:"خرید"})]})}),(0,r.jsx)(y.Z,{open:k.confirmDialogOpen,onClose:O.closeConfirmDialog,title:(0,r.jsx)("span",{className:"block large-1",children:"تأیید خرید"}),confirmButtonLabel:"خرید",timeout:30*h.uH,isLoading:F,onConfirm:S.submit,values:[{label:"مقدار طلا",value:(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{className:"ltr",children:(0,N.V)((0,u.Yu)(+k.amount))})," ","گرم"]})},{label:"به ارزش کل",value:(0,r.jsxs)("span",{children:[(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{className:"ltr",children:(0,N.V)(u.rn.getFormattedText(k.total))})," ","ریال"]}),(0,r.jsxs)("span",{className:"block margin-s-2 small-3 color-gray",children:[(0,r.jsx)("span",{className:"ltr",children:(0,N.V)(u.rn.getFormattedText("".concat(Math.round(+k.total/10))))})," ","تومان"]})]})}]})]})}}},function(a){a.O(0,[7616,1161,6336,4110,9774,2888,179],function(){return a(a.s=1912)}),_N_E=a.O()}]);