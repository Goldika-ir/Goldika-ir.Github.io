(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7564],{1912:function(a,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/panel/buy",function(){return t(5410)}])},5410:function(a,e,t){"use strict";t.r(e),t.d(e,{default:function(){return F}});var r=t(5893),n=t(629),l=t(1313),o=t(1737),s=t(3321),i=t(2140),c=t(5549),u=t(9392),m=t(4763),d=t(9922),p=t(9186),x=t(5608),g=t(3409),h=t(6445),N=t(1907),f=t(4006),b=t(6840),v=t(7294),j=t(3710),E=t(489),y=t(8135),w=t(6717);function A(){return c.wp.getValue().buy}function V(a){return c.Os.getValue()[a]}function F(){let a=c.wp.use(),e=a.buy,t=c.Os.use(),[F,k]=(0,x.YZ)(),O=(0,x.YM)(()=>({amount:"",amountError:null,total:"",totalError:null,formErrors:[],validatedOnce:!1,sliderValue:0,valueFromSlider:!0,confirmDialogOpen:!1,version:0})),S=(0,x.GK)(()=>({setAmount:(0,b.yH)(O,"amount",a=>{O.amountError=null,S.update(""===a?NaN:+a,"setTotal")}),setTotal:(0,b.yH)(O,"total",a=>{O.totalError=null,S.update(""===a?NaN:+a/A(),"setAmount")}),reset(){O.amount="",O.amountError=null,O.total="",O.totalError=null,O.formErrors=[],O.validatedOnce=!1,O.sliderValue=0,O.valueFromSlider=!0,O.confirmDialogOpen=!1},async fixAmount(){let a=await O.currentState;a.valueFromSlider||S.update(""===a.amount?NaN:+m.YL.getFormattedText(a.amount),"setBoth")},maxAmount:()=>Math.floor(V("rial")/A()*100)/100,update(a,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"noMax";if(O.valueFromSlider=!1,Number.isNaN(a)){("setAmount"===e||"setBoth"===e)&&(O.amount="",O.amountError=null),("setTotal"===e||"setBoth"===e)&&(O.total="",O.totalError=null),S.revalidate();return}a=Math.round(100*a)/100,"maxAmount"===t&&(a=Math.min(a,S.maxAmount())),("setAmount"===e||"setBoth"===e)&&(O.amount=(0,m.Yu)(a)),("setTotal"===e||"setBoth"===e)&&(O.total="".concat(10*Math.round(a*A()/10))),S.revalidate()},setSliderValue(a,e){if(Array.isArray(e))throw Error("Assertion error.");O.sliderValue=e,S.update(V("rial")*(e/100)/A(),"setBoth","maxAmount"),O.valueFromSlider=!0},formatSliderLabel:a=>(0,f.V)("".concat(a,"٪")),async revalidate(){O.renderedState.validatedOnce&&S.validate(await O.currentState)},validate(a){var e;let t=[],r=!0;O.validatedOnce=!0;let n=+a.amount;return(null===(e=c.W4.getValue())||void 0===e?void 0:e.isGuest)&&(t.push("شما کاربر مهمان هستید و امکان خرید ندارید."),r=!1),isNaN(n)?(O.amountError="مقدار وارد شده صحبح نیست.",r=!1):(O.amountError=null,n<.01&&(t.push("حداقل مقدار خرید طلا ".concat((0,f.V)("".concat(.01))," گرم می‌باشد.")),r=!1),V("rial")<A()*n&&(r=!1)),O.formErrors=t,r},openConfirmDialog:(0,b.PF)(async function(){let a=await O.currentState;S.update(+a.amount,"setBoth","maxAmount"),S.validate(a)&&(O.confirmDialogOpen=!0)}),closeConfirmDialog(){O.confirmDialogOpen=!1}})),T=(0,g.M)(()=>({submit:(0,N.K)(O,async e=>{await (0,E.E6)({action:"buy",amount:+e.amount,priceId:a.id}),i.Mn.manager.action(),S.reset()},{addLoadingCounter:k,validator:S.validate,successMessage:"معامله‌ی شما با موفقیت انجام شد.",errorMessage:u.e$})})),C=O.confirmDialogOpen;return(0,v.useEffect)(()=>(C||i.OG.start(),i.Mn.start(),()=>{i.OG.cancel(),i.Mn.cancel()}),[C]),(0,r.jsxs)(w.Z,{maxWidth:30,children:[(0,r.jsx)("form",{onSubmit:S.openConfirmDialog,children:(0,r.jsxs)(n.Z,{className:"back-bg2 margin-tb-1 padding-a-3",children:[(0,r.jsxs)("div",{className:"row xitems-center margin-b-2 margin-t-1 margin-se-2",children:[(0,r.jsx)(j.f6,{className:"svg-icon large margin-e-1"}),(0,r.jsxs)("span",{className:"grow",children:[(0,r.jsx)("span",{className:"bold-2 large-p5",children:"خرید طلا"}),(0,r.jsx)("div",{className:"grow"}),(0,r.jsx)("div",{className:"row",children:(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{children:"قیمت خرید:"})," ",(0,r.jsx)("span",{className:"ltr color-buy",children:(0,f.V)(m.rn.getFormattedText("".concat(e)))})," ","ریال"]})})]})]}),(0,r.jsx)(d.x,{className:"margin-t-2",label:"مقدار طلا",value:O.amount,onValueChange:S.setAmount,onBlur:S.fixAmount,textFormatter:m.YL,error:null!==O.amountError,helperText:O.amountError,InputProps:{className:"back-bg",endAdornment:(0,r.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"گرم"})},autoFocus:!0,autoComplete:"off",inputProps:{className:"ltr"}}),(0,r.jsx)(d.x,{className:"margin-t-2",label:"ارزش کل",value:O.total,onValueChange:S.setTotal,onBlur:S.fixAmount,textFormatter:m.rn,error:null!==O.totalError,helperText:O.totalError,InputProps:{className:"back-bg",endAdornment:(0,r.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"ریال"})},autoComplete:"off",inputProps:{className:"ltr"}}),(0,r.jsxs)("span",{className:"margin-tb-2 padding-s-2 block",children:[(0,r.jsx)(j.Fl,{className:"svg-icon margin-e-1"}),(0,r.jsx)("span",{children:"موجودی کیف پول:"})," ",(0,r.jsx)("span",{className:"ltr",children:(0,f.V)(m.rn.getFormattedText("".concat(t.rial)))})," ","ریال"]}),(0,r.jsx)("div",{className:"margin-se-3",children:(0,r.jsx)(l.ZP,{step:10,marks:!0,min:0,max:100,valueLabelFormat:S.formatSliderLabel,value:O.sliderValue,onChange:S.setSliderValue,color:O.valueFromSlider?"primary":"gray",valueLabelDisplay:"auto"})}),+O.total>t.rial&&(0,r.jsx)(o.Z,{className:"margin-tb-3",severity:"warning",action:(0,r.jsx)(p.Qj,{variant:"text",color:"inherit",href:{pathname:"/panel/deposit",query:{amount:"".concat(+O.total-t.rial)}},children:"افزایش موجودی"}),children:(0,r.jsx)("b",{className:"block",children:"موجودی کیف پول کافی نیست."})}),0!==O.formErrors.length&&(0,r.jsx)(o.Z,{className:"margin-tb-3",severity:"error",children:O.formErrors.map((a,e)=>(0,r.jsx)("b",{className:"block",children:a},e))}),(0,r.jsx)(s.Z,{className:"xself-center margin-t-2 padding-se-5",color:"buy",type:"submit",children:"خرید"})]})}),(0,r.jsx)(y.Z,{open:O.confirmDialogOpen,onClose:S.closeConfirmDialog,title:(0,r.jsx)("span",{className:"block large-1",children:"تأیید خرید"}),confirmButtonLabel:"خرید",timeout:30*h.uH,isLoading:F,onConfirm:T.submit,values:[{label:"مقدار طلا",value:(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{className:"ltr",children:(0,f.V)((0,m.Yu)(+O.amount))})," ","گرم"]})},{label:"به ارزش کل",value:(0,r.jsxs)("span",{children:[(0,r.jsxs)("span",{className:"block",children:[(0,r.jsx)("span",{className:"ltr",children:(0,f.V)(m.rn.getFormattedText(O.total))})," ","ریال"]}),(0,r.jsxs)("span",{className:"block margin-s-2 small-3 color-gray",children:[(0,r.jsx)("span",{className:"ltr",children:(0,f.V)(m.rn.getFormattedText("".concat(Math.round(+O.total/10))))})," ","تومان"]})]})}]})]})}}},function(a){a.O(0,[7616,9588,6336,4110,9774,2888,179],function(){return a(a.s=1912)}),_N_E=a.O()}]);