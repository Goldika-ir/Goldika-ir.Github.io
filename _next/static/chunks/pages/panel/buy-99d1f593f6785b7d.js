(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7564],{1912:function(a,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/panel/buy",function(){return r(5410)}])},5410:function(a,e,r){"use strict";r.r(e),r.d(e,{default:function(){return w}});var t=r(5893),n=r(629),l=r(1313),s=r(1737),o=r(3321),i=r(2140),c=r(5549),m=r(9392),u=r(4763),d=r(9922),p=r(9186),x=r(5608),h=r(3409),g=r(6445),N=r(1907),f=r(4006),b=r(6840),j=r(7294),v=r(3710),E=r(489),y=r(8135),V=r(6717);function F(){return c.wp.getValue().buy}function k(a){return c.Os.getValue()[a]}function w(){let a=c.wp.use(),e=a.buy,r=c.Os.use(),[w,A]=(0,x.YZ)(),O=(0,x.YM)(()=>({amount:"",amountError:null,total:"",totalError:null,formErrors:[],validatedOnce:!1,sliderValue:0,valueFromSlider:!0,confirmDialogOpen:!1,version:0})),T=(0,x.GK)(()=>({setAmount:(0,b.yH)(O,"amount",a=>{O.amountError=null,T.update(""===a?NaN:+a,"setTotal")}),setTotal:(0,b.yH)(O,"total",a=>{O.totalError=null,T.update(""===a?NaN:+a/F(),"setAmount")}),reset(){O.amount="",O.amountError=null,O.total="",O.totalError=null,O.formErrors=[],O.validatedOnce=!1,O.sliderValue=0,O.valueFromSlider=!0,O.confirmDialogOpen=!1},async fixAmount(){let a=await O.currentState;a.valueFromSlider||T.update(""===a.amount?NaN:+u.YL.getFormattedText(a.amount),"setBoth")},maxAmount:()=>Math.floor(k("rial")/F()*100)/100,update(a,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"noMax";if(O.valueFromSlider=!1,Number.isNaN(a)){("setAmount"===e||"setBoth"===e)&&(O.amount="",O.amountError=null),("setTotal"===e||"setBoth"===e)&&(O.total="",O.totalError=null),T.revalidate();return}a=Math.round(100*a)/100,"maxAmount"===r&&(a=Math.min(a,T.maxAmount())),("setAmount"===e||"setBoth"===e)&&(O.amount=(0,u.Yu)(a)),("setTotal"===e||"setBoth"===e)&&(O.total="".concat(10*Math.round(a*F()/10))),T.revalidate()},setSliderValue(a,e){if(Array.isArray(e))throw Error("Assertion error.");O.sliderValue=e,T.update(k("rial")*(e/100)/F(),"setBoth","maxAmount"),O.valueFromSlider=!0},formatSliderLabel:a=>(0,f.V)("".concat(a,"٪")),async revalidate(){O.renderedState.validatedOnce&&T.validate(await O.currentState)},validate(a){let e=[],r=!0;O.validatedOnce=!0;let t=+a.amount;return isNaN(t)?(O.amountError="مقدار وارد شده صحبح نیست.",r=!1):(O.amountError=null,t<.01&&(e.push("حداقل مقدار خرید طلا ".concat((0,f.V)("".concat(.01))," گرم می‌باشد.")),r=!1),k("rial")<F()*t&&(r=!1)),O.formErrors=e,r},openConfirmDialog:(0,b.PF)(async function(){let a=await O.currentState;T.update(+a.amount,"setBoth","maxAmount"),T.validate(a)&&(O.confirmDialogOpen=!0)}),closeConfirmDialog(){O.confirmDialogOpen=!1}})),S=(0,h.M)(()=>({submit:(0,N.K)(O,async e=>{await (0,E.E6)({action:"buy",amount:+e.amount,priceId:a.id}),i.Mn.manager.func(),T.reset()},{addLoadingCounter:A,validator:T.validate,successMessage:"معامله‌ی شما با موفقیت انجام شد.",errorMessage:m.e$})})),M=O.confirmDialogOpen;return(0,j.useEffect)(()=>(M||i.OG.start(),i.Mn.start(),()=>{i.OG.cancel(),i.Mn.cancel()}),[M]),(0,t.jsxs)(V.Z,{maxWidth:30,children:[(0,t.jsx)("form",{onSubmit:T.openConfirmDialog,children:(0,t.jsxs)(n.Z,{className:"back-bg2 margin-tb-1 padding-a-3",children:[(0,t.jsxs)("div",{className:"row xitems-center margin-b-2 margin-t-1 margin-se-2",children:[(0,t.jsx)(v.f6,{className:"svg-icon large margin-e-1"}),(0,t.jsxs)("span",{className:"grow",children:[(0,t.jsx)("span",{className:"bold-2 large-p5",children:"خرید طلا"}),(0,t.jsx)("div",{className:"grow"}),(0,t.jsx)("div",{className:"row",children:(0,t.jsxs)("span",{className:"block",children:[(0,t.jsx)("span",{children:"قیمت خرید:"})," ",(0,t.jsx)("span",{className:"ltr color-buy",children:(0,f.V)(u.rn.getFormattedText("".concat(e)))})," ","ریال"]})})]})]}),(0,t.jsx)(d.x,{className:"margin-t-2",label:"مقدار طلا",value:O.amount,onValueChange:T.setAmount,onBlur:T.fixAmount,textFormatter:u.YL,error:null!==O.amountError,helperText:O.amountError,InputProps:{className:"back-bg",endAdornment:(0,t.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"گرم"})},autoFocus:!0,autoComplete:"off",inputProps:{className:"ltr"}}),(0,t.jsx)(d.x,{className:"margin-t-2",label:"ارزش کل",value:O.total,onValueChange:T.setTotal,onBlur:T.fixAmount,textFormatter:u.rn,error:null!==O.totalError,helperText:O.totalError,InputProps:{className:"back-bg",endAdornment:(0,t.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"ریال"})},autoComplete:"off",inputProps:{className:"ltr"}}),(0,t.jsxs)("span",{className:"margin-tb-2 padding-s-2 block",children:[(0,t.jsx)(v.Fl,{className:"svg-icon margin-e-1"}),(0,t.jsx)("span",{children:"موجودی کیف پول:"})," ",(0,t.jsx)("span",{className:"ltr",children:(0,f.V)(u.rn.getFormattedText("".concat(r.rial)))})," ","ریال"]}),(0,t.jsx)("div",{className:"margin-se-3",children:(0,t.jsx)(l.ZP,{step:10,marks:!0,min:0,max:100,valueLabelFormat:T.formatSliderLabel,value:O.sliderValue,onChange:T.setSliderValue,color:O.valueFromSlider?"primary":"gray",valueLabelDisplay:"auto"})}),+O.total>r.rial&&(0,t.jsx)(s.Z,{className:"margin-tb-3",severity:"warning",action:(0,t.jsx)(p.Qj,{variant:"text",color:"inherit",href:{pathname:"/panel/deposit",query:{amount:"".concat(+O.total-r.rial)}},children:"افزایش موجودی"}),children:(0,t.jsx)("b",{className:"block",children:"موجودی کیف پول کافی نیست."})}),0!==O.formErrors.length&&(0,t.jsx)(s.Z,{className:"margin-tb-3",severity:"error",children:O.formErrors.map((a,e)=>(0,t.jsx)("b",{className:"block",children:a},e))}),(0,t.jsx)(o.Z,{className:"xself-center margin-t-2 padding-se-5",color:"buy",type:"submit",children:"خرید"})]})}),(0,t.jsx)(y.Z,{open:O.confirmDialogOpen,onClose:T.closeConfirmDialog,title:(0,t.jsxs)("span",{className:"block large-1",children:["تأیید خرید"," ",(0,t.jsx)("span",{className:"ltr",children:(0,f.V)((0,u.Yu)(+O.amount))})," ","گرم طلا"]}),confirmButtonLabel:"خرید",timeout:30*g.uH,isLoading:w,onConfirm:S.submit,values:[{label:"قیمت خرید",value:(0,t.jsxs)("span",{children:[(0,t.jsxs)("span",{className:"block",children:[(0,t.jsx)("span",{className:"ltr",children:(0,f.V)(u.rn.getFormattedText("".concat(e)))})," ","ریال"]}),(0,t.jsxs)("span",{className:"block margin-s-2 small-3 color-gray",children:[(0,t.jsx)("span",{className:"ltr",children:(0,f.V)(u.rn.getFormattedText("".concat(Math.round(e/10))))})," ","تومان"]})]})},{label:"مقدار طلا",value:(0,t.jsxs)("span",{className:"block",children:[(0,t.jsx)("span",{className:"ltr",children:(0,f.V)((0,u.Yu)(+O.amount))})," ","گرم"]})},{label:"ارزش کل",value:(0,t.jsxs)("span",{children:[(0,t.jsxs)("span",{className:"block",children:[(0,t.jsx)("span",{className:"ltr",children:(0,f.V)(u.rn.getFormattedText(O.total))})," ","ریال"]}),(0,t.jsxs)("span",{className:"block margin-s-2 small-3 color-gray",children:[(0,t.jsx)("span",{className:"ltr",children:(0,f.V)(u.rn.getFormattedText("".concat(Math.round(+O.total/10))))})," ","تومان"]})]})}]})]})}}},function(a){a.O(0,[7616,9588,7449,4110,9774,2888,179],function(){return a(a.s=1912)}),_N_E=a.O()}]);