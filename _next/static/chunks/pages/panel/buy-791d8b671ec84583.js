(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7564],{1912:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/panel/buy",function(){return a(5410)}])},9399:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(5893),r=a(6010);function l(e){var t;return(0,n.jsx)("div",{ref:e.rootRef,className:(0,r.Z)("grow xitems-center",e.className),style:e.style,children:(0,n.jsxs)("div",{className:"grow",style:{width:"100%",maxWidth:"".concat(null!==(t=e.maxWidth)&&void 0!==t?t:40,"em")},children:[(e.title||e.topEnd)&&(0,n.jsxs)("span",{className:"row margin-b-2 large-3",children:[(0,n.jsx)("span",{children:e.title}),(0,n.jsx)("div",{className:"grow"}),e.topEnd]}),e.children]})})}},9922:function(e,t,a){"use strict";a.d(t,{x:function(){return c}});var n=a(5893),r=a(5608),l=a(1442),o=a(4006),s=a(7294),i=a(6529);let c=(0,s.forwardRef)(function(e,t){var a,c,u;let d=(0,l.G)(e.inputRef),m=(0,r.xj)(e),{textFormatter:p,useLatinDigits:g,value:f,onValueChange:x,...v}=m,h=(0,r.GK)(()=>({onChange(e){var t,a;let n=(0,o.J)((0,i.Vz)(e.target)),r=m.textFormatter?(null!==(a=m.textFormatter.getRawText)&&void 0!==a?a:m.textFormatter.getFormattedText)(n):n,l=(0,i.KR)(r);h.selectionMap[l.value]=r,null===(t=m.onValueChange)||void 0===t||t.call(m,l)},selectionMap:{},selectionMapOld:{}}));(0,s.useLayoutEffect)(()=>{var e;let t={[f]:null!==(e=h.selectionMap[f])&&void 0!==e?e:h.selectionMapOld[f]};h.selectionMapOld=h.selectionMap,h.selectionMap=t}),(0,r.qR)(()=>{if(m.autoFocus&&d.current){d.current.focus();let e=d.current.value.length;d.current.setSelectionRange(e,e)}});let b=null!==(c=null!==(a=h.selectionMap[f])&&void 0!==a?a:h.selectionMapOld[f])&&void 0!==c?c:f,N=null!==(u=null==p?void 0:p.getFormattedText(b))&&void 0!==u?u:b;return(0,n.jsx)(i.Gn,{ref:t,onChange:h.onChange,selectionValue:g?N:(0,o.V)(N),...v,inputRef:d})})},489:function(e,t,a){"use strict";a.d(t,{E6:function(){return u},NA:function(){return o},ft:function(){return i},qj:function(){return s},v9:function(){return c}});var n,r,l=a(5829);function o(e){return l._.invoke({url:"deposits/pay",body:{amount:e.amountRial,account_id:e.accountId}})}(n=r||(r={}))[n.Success=1]="Success",n[n.Failed=-1]="Failed",n[n.Pending=0]="Pending";let s={[r.Success]:"succeeded",[r.Failed]:"failed",[r.Pending]:"pending"};function i(e){return l._.invoke({url:"withdraws/erial",body:{amount:e.amount,account_id:e.accountId}})}function c(){return l._.invoke({url:"exchanges"})}function u(e){return l._.invoke({url:"exchanges/".concat(e.action,"/egold/erial"),body:e})}},5410:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var n=a(5893),r=a(629),l=a(2435),o=a(1737),s=a(3321),i=a(9399),c=a(2140),u=a(8845),d=a(9979),m=a(4763),p=a(9922),g=a(9186),f=a(5608),x=a(3409),v=a(6445),h=a(1907),b=a(4006),N=a(6840),j=a(3710),w=a(489),y=a(8135);function E(){return u.wp.getValue().buy}function k(e){return u.Os.getValue()[e]}function C(){let e=u.wp.use(),t=e.buy,a=u.Os.use(),[C,F]=(0,f.YZ)(),M=(0,f.YM)(()=>({amount:"",amountError:null,total:"",totalError:null,formErrors:[],validatedOnce:!1,sliderValue:0,valueFromSlider:!0,confirmDialogOpen:!1,version:0})),O=(0,f.GK)(()=>({setAmount:(0,N.yH)(M,"amount",e=>{M.amountError=null,O.update(""===e?NaN:+e,"setTotal")}),setTotal:(0,N.yH)(M,"total",e=>{M.totalError=null,O.update(""===e?NaN:+e/E(),"setAmount")}),reset(){M.amount="",M.amountError=null,M.total="",M.totalError=null,M.formErrors=[],M.validatedOnce=!1,M.sliderValue=0,M.valueFromSlider=!0,O.closeConfirmDialog()},async fixAmount(){let e=await M.currentState;e.valueFromSlider||O.update(""===e.amount?NaN:+m.YL.getFormattedText(e.amount),"setBoth")},maxAmount:()=>Math.floor(k("rial")/E()*m.bM)/m.bM,update(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"noMax";if(M.valueFromSlider=!1,Number.isNaN(e)){("setAmount"===t||"setBoth"===t)&&(M.amount="",M.amountError=null),("setTotal"===t||"setBoth"===t)&&(M.total="",M.totalError=null),O.revalidate();return}e=Math.round(e*m.bM)/m.bM,"maxAmount"===a&&(e=Math.min(e,O.maxAmount())),("setAmount"===t||"setBoth"===t)&&(M.amount=(0,m.Yu)(e)),("setTotal"===t||"setBoth"===t)&&(M.total="".concat(10*Math.round(e*E()/10))),O.revalidate()},setSliderValue(e,t){if(Array.isArray(t))throw Error("Assertion error.");M.sliderValue=t,O.update(k("rial")*(t/100)/E(),"setBoth","maxAmount"),M.valueFromSlider=!0},formatSliderLabel:e=>(0,b.V)("".concat(e,"%")),async revalidate(){M.renderedState.validatedOnce&&O.validate(await M.currentState)},validate(e){var t;let a=[],n=!0;M.validatedOnce=!0;let r=+e.amount;return(null===(t=u.W4.getValue())||void 0===t?void 0:t.isGuest)&&(a.push("شما کاربر مهمان هستید و امکان خرید ندارید."),n=!1),Number.isFinite(r)?(M.amountError=null,r<.001&&(a.push("حداقل مقدار خرید طلا ".concat((0,b.V)("".concat(.001))," گرم می‌باشد.")),n=!1),k("rial")<E()*r&&(n=!1)):(M.amountError="مقدار وارد شده صحبح نیست.",n=!1),M.formErrors=a,n},openConfirmDialog:(0,N.PF)(async function(){let e=await M.currentState;O.update(+e.amount,"setBoth","maxAmount"),O.validate(e)&&(u.wp.lock(),M.confirmDialogOpen=!0)}),closeConfirmDialog(){u.wp.unlock(),M.confirmDialogOpen=!1}})),S=(0,x.M)(()=>({submit:(0,h.K)(M,async t=>{await (0,w.E6)({action:"buy",amount:+t.amount,priceId:e.id}),c.Mn.manager.action(),O.reset()},{addLoadingCounter:F,validator:O.validate,successMessage:"معامله‌ی شما با موفقیت انجام شد.",errorMessage:d.e$,onError:()=>{c.OG.manager.action(),O.closeConfirmDialog()}})}));return(0,f.qR)(()=>(M.renderedState.confirmDialogOpen||u.wp.unlock(),c.OG.start(),c.Mn.start(),()=>{c.OG.cancel(),c.Mn.cancel()})),(0,n.jsxs)(i.Z,{maxWidth:30,children:[(0,n.jsx)("form",{onSubmit:O.openConfirmDialog,children:(0,n.jsxs)(r.Z,{className:"back-bg2 margin-tb-1 padding-a-3",children:[(0,n.jsxs)("div",{className:"row xitems-center margin-b-2 margin-t-1 margin-se-2",children:[(0,n.jsx)(j.f6,{className:"svg-icon large margin-e-1"}),(0,n.jsxs)("span",{className:"grow",children:[(0,n.jsx)("span",{className:"bold-2 large-p5",children:"خرید طلا"}),(0,n.jsx)("div",{className:"grow"}),(0,n.jsx)("div",{className:"row",children:(0,n.jsxs)("span",{className:"block",children:[(0,n.jsx)("span",{children:"قیمت خرید:"})," ",(0,n.jsx)("span",{className:"ltr color-buy",children:(0,b.V)(m.rn.getFormattedText("".concat(t)))})," ","ریال"]})})]})]}),(0,n.jsx)(p.x,{className:"margin-t-2",label:"مقدار طلا",value:M.amount,onValueChange:O.setAmount,onBlur:O.fixAmount,textFormatter:m.YL,error:null!==M.amountError,helperText:M.amountError,InputProps:{className:"back-bg",endAdornment:(0,n.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"گرم"})},autoFocus:!0,autoComplete:"off",inputProps:{className:"ltr"}}),(0,n.jsx)(p.x,{className:"margin-t-2",label:"ارزش کل",value:M.total,onValueChange:O.setTotal,onBlur:O.fixAmount,textFormatter:m.rn,error:null!==M.totalError,helperText:M.totalError,InputProps:{className:"back-bg",endAdornment:(0,n.jsx)("span",{className:"padding-s-3 padding-e-1 no-pointer-events",children:"ریال"})},autoComplete:"off",inputProps:{className:"ltr"}}),(0,n.jsxs)("span",{className:"margin-tb-2 padding-s-2 block",children:[(0,n.jsx)(j.Fl,{className:"svg-icon margin-e-1"}),(0,n.jsx)("span",{children:"موجودی کیف پول:"})," ",(0,n.jsx)("span",{className:"ltr",children:(0,b.V)(m.rn.getFormattedText("".concat(a.rial)))})," ","ریال"]}),(0,n.jsx)("div",{className:"margin-se-3",children:(0,n.jsx)(l.ZP,{step:10,marks:!0,min:0,max:100,valueLabelFormat:O.formatSliderLabel,value:M.sliderValue,onChange:O.setSliderValue,color:M.valueFromSlider?"primary":"gray",valueLabelDisplay:"auto"})}),+M.total>a.rial&&(0,n.jsx)(o.Z,{className:"margin-tb-3",severity:"warning",action:(0,n.jsx)(g.Qj,{variant:"text",color:"inherit",href:{pathname:"/panel/deposit",query:{amount:"".concat(+M.total-a.rial)}},size:"small",style:{textDecoration:"underline"},children:"افزایش موجودی"}),children:(0,n.jsx)("b",{className:"block",children:"موجودی کیف پول کافی نیست."})}),0!==M.formErrors.length&&(0,n.jsx)(o.Z,{className:"margin-tb-3",severity:"error",children:M.formErrors.map((e,t)=>(0,n.jsx)("b",{className:"block margin-tb-p5",children:e},t))}),(0,n.jsx)(s.Z,{className:"xself-center margin-t-2 padding-se-5",color:"buy",type:"submit",children:"خرید"})]})}),(0,n.jsx)(y.Z,{open:M.confirmDialogOpen,onClose:O.closeConfirmDialog,title:(0,n.jsx)("span",{className:"block large-1",children:"تأیید خرید"}),confirmButtonLabel:"خرید",timeout:30*v.uH,isLoading:C,onConfirm:S.submit,values:[{label:"مقدار طلا",value:(0,n.jsxs)("span",{className:"block",children:[(0,n.jsx)("span",{className:"ltr",children:(0,b.V)((0,m.Yu)(+M.amount))})," ","گرم"]})},{label:"به ارزش کل",value:(0,n.jsxs)("span",{children:[(0,n.jsxs)("span",{className:"block",children:[(0,n.jsx)("span",{className:"ltr",children:(0,b.V)(m.rn.getFormattedText(M.total))})," ","ریال"]}),(0,n.jsxs)("span",{className:"block margin-s-2 small-3 color-gray",children:[(0,n.jsx)("span",{className:"ltr",children:(0,b.V)(m.rn.getFormattedText("".concat(Math.round(+M.total/10))))})," ","تومان"]})]})}]})]})}},8135:function(e,t,a){"use strict";a.d(t,{Z:function(){return p}});var n=a(5893),r=a(2029),l=a(657),o=a(7645),s=a(1425),i=a(3321),c=a(5608),u=a(6445),d=a(7294),m=a(9686);function p(e){var t,a;let p=(0,c.xj)(e),g=(0,c.GK)(()=>({back(e){var t;null===(t=p.onClose)||void 0===t||t.call(p,e,"backButton")},keyDown(e){if("Enter"===e.key){var t;e.stopPropagation(),null===(t=p.onConfirm)||void 0===t||t.call(p)}},timeoutConfig:(0,m.nW)({get started(){return p.open},get timeout(){return p.timeout},timedOut(){var e;null===(e=p.onClose)||void 0===e||e.call(p,{},"timeout")}})}));return!function(e){let t=(0,c.GK)(()=>({lastStarted:!1,startTime:0,version:0}));(0,d.useEffect)(()=>{if(t.version=(0,u.hi)(t.version),t.lastStarted!==e.started){if(!e.started)return;t.startTime=performance.now()}let a=t.version;(async()=>{for(;;){if(void 0===e.timeout)return;let n=t.startTime+e.timeout-performance.now();if(n<=0){e.timedOut();return}if(await (0,u.gw)(n),a!==t.version)return}})()},[e.started,e.timeout])}(g.timeoutConfig),(0,n.jsxs)(l.Z,{open:p.open,onClose:p.isLoading?void 0:p.onClose,onKeyDown:g.keyDown,fullWidth:!0,maxWidth:"xs",children:[void 0!==p.title&&(0,n.jsx)(o.Z,{children:p.title}),(0,n.jsx)("div",{className:"margin-a-4",children:p.values.map((e,t)=>(0,n.jsxs)("div",{className:"margin-b-2",children:[(0,n.jsxs)("span",{className:"small-1 margin-b-1",children:[e.label,":"]}),(0,n.jsx)("span",{className:"margin-s-2 large-1",children:e.value})]},t))}),(0,n.jsxs)(s.Z,{children:[(0,n.jsx)(r.Z,{className:"padding-se-4",onClick:p.onConfirm,loading:p.isLoading,size:"large",children:null!==(t=p.confirmButtonLabel)&&void 0!==t?t:"تأیید"}),(0,n.jsx)(i.Z,{className:"margin-e-2",onClick:g.back,variant:"text",color:"inherit",disabled:p.isLoading,children:null!==(a=p.cancelButtonLabel)&&void 0!==a?a:"انصراف"})]})]})}}},function(e){e.O(0,[9837,9774,2888,179],function(){return e(e.s=1912)}),_N_E=e.O()}]);